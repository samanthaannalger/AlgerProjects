BeeAbunSum<- ddply(BeeAbun, c("site"), summarise,
HB_Abun = mean(HB, na.rm=TRUE))
#merge HB proportion data to bombus data
BombSurv <- merge(BombSurv, BeeAbunSum, by=c("site"), all.x=TRUE, all.y=FALSE)
#---------------------------------------------------------------------------
BombSurvSplit <- split(BombSurv, BombSurv$target_name)
BombSurvSplit$IAPV$HBSiteBin <- rep(NA, length(BombSurvSplit$IAPV$virusBINY))
BombSurvSplit$BQCV$HBSiteBin <- rep(NA, length(BombSurvSplit$BQCV$virusBINY))
BombSurvSplit$DWV$HBSiteBin <- ifelse(log(BombSurvSplit$DWV$norm_genome_copbeeHB) > 15, "High", "Low")
BombSurv <- rbind(BombSurvSplit$DWV, BombSurvSplit$BQCV, BombSurvSplit$IAPV)
#---------------------------------------------------------------------------
# END OF DATA CLEANING
#Export csv
write.csv(BombSurv, file = "BombSurv.csv")
#---------------------------------------------------------------------
#Working with NHBS data
#Adding NHBS data to BombSurv
Bomb_NHBS <- merge(BombSurv, NHBS, by=c("site"), all.x=TRUE, all.y=FALSE)
#remove NA rows from dataframe
Bomb_NHBS <- Bomb_NHBS[which(Bomb_NHBS$Apiary_name!="NA"),]
#split dataframe by bombus target
Bomb_NHBS_Split <- split(Bomb_NHBS, Bomb_NHBS$target_name)
Bomb_NHBS_Sum <- ddply(Bomb_NHBS_Split$DWV, c("site", "target_name", "Varroa100", "DWV_CPB"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
#relationship between Varroa and bumble bee DWV loads
plot(Bomb_NHBS_Split$DWV$Varroa100,log(Bomb_NHBS_Split$DWV$norm_genome_copbee))
#relationship between NHBS DWV loads and My HB DWV loads
plot(log(Bomb_NHBS_Split$DWV$DWV_CPB),log(Bomb_NHBS_Split$DWV$norm_genome_copbeeHB))
#relationship between Varroa and bumble bee DWV prev.
plot(Bomb_NHBS_Sum$Varroa100,Bomb_NHBS_Sum$mean)
#relationship between Varroa and bumble bee DWV prev.
plot(log(Bomb_NHBS_Sum$DWV_CPB),Bomb_NHBS_Sum$mean)
plot(Bomb_NHBS_Split$DWV$Varroa100,log(Bomb_NHBS_Split$DWV$norm_genome_copbee))
#relationship between NHBS DWV loads and My HB DWV loads
plot(log(Bomb_NHBS_Split$DWV$DWV_CPB),log(Bomb_NHBS_Split$DWV$norm_genome_copbeeHB))
#relationship between Varroa and bumble bee DWV prev.
# uaing ddply to get summary of virusBINY by species and target name
VirusSum <- ddply(keptstuff, c("species", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
#remove data for species other than vagans and bimaculatus
VirusSum <-VirusSum[-c(4:9),]
#choosing color pallet
colors <- c("slategray3", "dodgerblue4")
#Create a bar graph for viruses by bombus species
#aes= aesthetics
plot1 <- ggplot(VirusSum, aes(x=target_name, y=mean, fill=species)) +
geom_bar(stat="identity",
position=position_dodge()) + labs(x="Virus", y = "% Prevalence")
plot1 + theme_minimal(base_size = 17) + scale_fill_manual(values=colors, name="Bombus Species:", labels=c("Bimaculatus", "Vagans"))
statsplit <- split(keptstuff, keptstuff$target_name)
# chi.sq test for BQCV prev. vs species (p < 0.00001)
chisq.test(statsplit$BQCV$virusBINY, statsplit$BQCV$species)
# chi.sq test for DWV prev. vs species (p = 0.947)
chisq.test(statsplit$DWV$virusBINY, statsplit$DWV$species)
# uaing ddply to get summary of virusBINY by site
SitePrev <- ddply(BombSurv, c("site", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
#remove Actin from HB data
HbDF<-HbDF[!(HbDF$target_name=="ACTIN"),]
#merge HB VL data to SitePrev
SitePrev <- merge(HbDF, SitePrev, by=c("site","target_name"), all.x=TRUE, all.y=FALSE)
# make NAs 0
SitePrev$norm_genome_copbeeHB[is.na(SitePrev$norm_genome_copbeeHB)] <- 0
#split site prev data by targets so that you can plot later
SplitSitePrev <- split(SitePrev,SitePrev$target_name)
#plotting data
plot(log(SplitSitePrev$BQCV$norm_genome_copbeeHB),SplitSitePrev$BQCV$mean)
plot(log(SplitSitePrev$DWV$norm_genome_copbeeHB),SplitSitePrev$DWV$mean)
plot(log(SplitSitePrev$IAPV$norm_genome_copbeeHB),SplitSitePrev$IAPV$mean)
## Assigning High or Low to HB VL data
SplitSitePrev$DWV$HBSiteBin <- ifelse(log(SplitSitePrev$DWV$norm_genome_copbeeHB) > 15, "High", "Low")
SplitSitePrevDWV <- select(SplitSitePrev$DWV, site, HBSiteBin)
#merge HB high low data to bombus data
DWV_Hb_Bomb_Bin <- merge(statsplit$DWV, SplitSitePrevDWV, by=c("site"), all.x=TRUE, all.y=FALSE)
DWV_for_merging <- select(DWV_Hb_Bomb_Bin, HBSiteBin, site, sample_name)
HBSiteSum <- ddply(DWV_Hb_Bomb_Bin, c("HBSiteBin", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
colors <- c("slategray3", "dodgerblue4", "blue4")
barplot(height=HBSiteSum$mean,
names.arg = c("HighHBLoad",
"LowHBLoad",
"NoHBCaught"),
xlab="Site Type",
ylab ="% Prevalence",
ylim = c(0,0.2),
main = "Bombus % Prevelence by HB Site Type",
col = colors
)
DWV_Hb_Bomb_Bin$HBSiteBin
chisq.test(DWV_Hb_Bomb_Bin$virusBINY, DWV_Hb_Bomb_Bin$HBSiteBin)
splitKept <- split(keptstuff, keptstuff$target_name)
x <- table(splitKept$DWV$site)
barplot(height = x, names.arg = NULL, las=2)
HBSiteSum <- ddply(DWV_Hb_Bomb_Bin, c("HBSiteBin", "site"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
t.test(HBSiteSum$mean~HBSiteSum$HBSiteBin)
#-----------------------------------------------------------
#Analysis of Bee Abundance Data
#split data by target
splitBomb_HB_Abund <- split(BombSurv, BombSurv$target_name)
#plot bee abundance by apiary present or not
plot(BombSurv$apiary_near_far,BombSurv$HB_Abun)
#chisq.test to see if there are differences in HB abundance between the two treatment groups, apiary present or not.
chisq.test(BombSurv$apiary_near_far, BombSurv$HB_Abun)
#Working on a bar graph that shows honey bee abundance on y axis and apiary near/far on x axis. Are there differences between the two treatment groups? This will help support "apiary present" "apiary absent" treatments.
barplot(height=cbind(BombSurv$HB_Abun,
(BombSurv$apiary_near_far),
names.arg = c("High DWV Load",
"Low DWV Load",
"No Apis Caught")))
#plotting bee abundance at each site by the bombus DWV viral load
plot(splitBomb_HB_Abund$DWV$HB_Abun,log(splitBomb_HB_Abund$DWV$norm_genome_copbee))
plot(splitBomb_HB_Abund$BQCV$HB_Abun,log(splitBomb_HB_Abund$BQCV$norm_genome_copbee))
#check out the bee abundance data
barplot(height = BeeAbunSum$HB_Abun, names.arg = BeeAbunSum$site, las=2)
plot1 + theme_minimal(base_size = 17) + scale_fill_manual(values=colors, name="Bombus Species:", labels=c("bimaculatus", "vagans"))
plot1 <- ggplot(VirusSum, aes(x=target_name, y=mean, fill=species)) +
geom_bar(stat="identity",
position=position_dodge()) + labs(x="Virus", y = "% Prevalence")
```{r, echo=FALSE, message=FALSE}
#Preliminaries:
# Clear memory of characters
ls()
rm(list=ls())
# Call blue color palette for graphics
library(RColorBrewer)
library(ggplot2)
library(dplyr)
library(plyr)
# Set Working Directory
setwd("~/Desktop/RScripts/2015_Bombus_Survey")
# read in data
BombSurv <- read.table("BombSurv.csv",header=TRUE,sep=",",stringsAsFactors=FALSE)
# remove unneeded columns from the DF
BombSurv <- select(BombSurv, -X, -Ct_mean, -Ct_sd, -quantity_mean, -quantity_sd, -run, -date_processed, -dil.factor, -genome_copbee, -Ct_mean_hb, -ID, -ACT_genome_copbee)
```
```{r,  echo=FALSE}
# using ddply to get summary of virusBINY by species and target name:
VirusSum <- ddply(BombSurv, c("species", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
# remove data for species other than vagans and :
VirusSum <-VirusSum[-c(4:9),]
#choosing color pallet
colors <- c("slategray3", "dodgerblue4")
#Create a bar graph for viruses by bombus species (aes= aesthetics):
plot1 <- ggplot(VirusSum, aes(x=target_name, y=mean, fill=species)) +
geom_bar(stat="identity",
position=position_dodge()) + labs(x="Virus", y = "% Prevalence")
plot1 + theme_minimal(base_size = 17) + scale_fill_manual(values=colors, name="Bombus Species:", labels=c("bimaculatus", "vagans")) + theme(legend.position=c(.8, .85)) + coord_cartesian(ylim = c(0, 1))
```
**Figure 1:** Percent prevalence (% of infected individuals) for two bumble bee species, *Bombus bimaculatus* and *Bombus vagans* for black queen cell virus (BQCV), deformed wing virus (DWV) and Israeli acute paralysis virus (IAPV). BQCV was significantly more prevalent among *B. bimaculatus* than *B. vagans* (p<0.00001). No significant differences in DWV prevalence between species (p = 0.9469). IAPV was detected only in low levels among a few individuals. This figure only includes bees with quantifiable viral infections above the threshold of detection.
```{r,  echo=FALSE, warning=FALSE,}
#stats for % prevalence, species differences
statsplit <- split(BombSurv, BombSurv$target_name)
# chi.sq test for BQCV prev. vs species (p < 0.00001)
chisq.test(statsplit$BQCV$virusBINY, statsplit$BQCV$species)
# chi.sq test for DWV prev. vs species (p = 0.9469)
chisq.test(statsplit$DWV$virusBINY, statsplit$DWV$species)
```
```{r,  echo=FALSE}
# make apiary binary a character so we can use it as a factor in the model
BombSurv$apiary_near_far <- as.character(BombSurv$apiary_near_far)
# using ddply to get summary of virusBINY by species and target name:
VirusSum1 <- ddply(BombSurv, c("apiary_near_far", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
VirusSum1 <-VirusSum1[-c(7:9),]
#choosing color pallet
colors <- c("slategray3", "dodgerblue4")
#Create a bar graph for viruses by bombus species (aes= aesthetics):
plot1 <- ggplot(VirusSum1, aes(x=target_name, y=mean, fill=apiary_near_far)) +
geom_bar(stat="identity",
position=position_dodge()) + labs(x="Virus", y = "% Prevalence")
plot1 + theme_minimal(base_size = 17) + scale_fill_manual(values=colors, name="Site Type:", labels=c("Apiary Absent", "Apiary Present")) + theme(legend.position=c(.8, .85)) + coord_cartesian(ylim = c(0, 1))
```
**Figure 2:** Percent prevalence of infected bumble bee individuals for black queen cell virus (BQCV), deformed wing virus (DWV) and Israeli acute paralysis virus (IAPV). Bumble bees were either caught in sites with honey bee apiaries present or no apiary nearby. BQCV (p<.0001) and DWV (p=.00225) were more prevalent in bumble bees caught in sites with a honey bee apiary present than in sites without an apiary nearby. IAPV was detected only in very low levels among a few individuals. This figure only includes bees with quantifiable viral infections above the threshold of detection for quantification.
```{r,  echo=FALSE, results=FALSE}
#stats for % prevalence, apiary_near_far differences
#remove NAs before doing test
PresAbst_stat <- BombSurv[which(BombSurv$apiary_near_far!="NA"),]
PresAbst_stat <- split(PresAbst_stat, PresAbst_stat$target_name)
# chi.sq test for BQCV prev. vs apiary_near_far (p < 0.00001)
chisq.test(PresAbst_stat$BQCV$virusBINY, PresAbst_stat$BQCV$apiary_near_far)
# chi.sq test for DWV prev. vs apiary_near_far (p = 0.00225)
chisq.test(PresAbst_stat$DWV$virusBINY, PresAbst_stat$DWV$apiary_near_far)
```
```{r,  echo=FALSE}
BombSurvSplit <- split(BombSurv, BombSurv$target_name)
HBSiteSum <- ddply(BombSurvSplit$DWV, c("HBSiteBin", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
colors <- c("slategray3", "dodgerblue4", "blue4")
barplot(height=HBSiteSum$mean,
names.arg = c("High DWV Load",
"Low DWV Load",
"No Apis Caught"),
xlab="Site Type",
ylab ="% Prevalence (Bombus with DWV)",
ylim = c(0,0.2),
main = "Bombus DWV Prevalence by Honey Bee DWV Load",
col = colors
)
```
**Figure 3:** Percent prevalance for Bumble bees infected with deformed wing virus at sites where honey bees had high and low viral loads, and sites where no honey bees were present and therefore could not be collected. DWV was more prevalent in bumble bees caught at sites with honey bees with high average viral loads, than sites with honey bees with low average viral loads (p = 0.046, X2 = 3.9767).
```{r,  echo=FALSE, results=FALSE}
#remove NA rows from dataframe
BombSurvSplit <- BombSurvSplit$DWV[which(BombSurvSplit$DWV$HBSiteBin!="NA"),]
# chi.sq test for High and Low DWV load sites
chisq.test(BombSurvSplit$HBSiteBin, BombSurvSplit$virusBINY)
```
```{r,  echo=FALSE}
```
---
title: "BombSurv2015"
author: "Samantha Alger & Alex Burnham"
date: "October 27, 2016"
output:
pdf_document:
fig_height: 5.5
fig_width: 7
html_document: default
---
**Metadata**
**Author:** Samantha Alger & Alex Burnham
**Date:** 27 October 2016
**Data Set:** These data were collected during the a 2015 Bumble Bee Survey in Vermont by Samantha Alger and Alex Burnham with all testing is being done at the University of Vermont
**Data Source:** 2015 Bumble Bee Survey
**Funding Source:** Garden Club of America, Pollinator Partnership, Fabri Fiahlo (UVM), Roger Williams Park Zoo Sophie Danforth Conservation Fund.
**Data Collection:** Bumble bees were netted from flowers at field sites.
**Columns:** (from left to right) Site ID, Target (Actin, DWV, IAPV, or BQCV), sample ID, From the qPCR results: Ctmean, Ctsd, quantity mean, quantitysd, Run # (QPCR), Date specimen was collected, Field ID, Bee species, plant the bee was caught on, date the specimen was processed in the lab, was pollen found on the leg and collected (0-no, 1- yes), dil.factor (RNA diluted), apiary present/not present at site (1, 0), genome copy for target (not normalized), ACTIN genome copy, normalized target genome copy (normalized using ACTIN), 6-10 Honey Bees were collected at each site, homogenized and assayed for viruses, 'norm_genome_copbeeHB' is the normalized genome copy for honey bee for the target specified, 'CTmeanhb' is the CT value for the honey bee for each target (from qpcr data), 'HB collected' is whether honeybees were collected and processed at that site, 1 or NA, virus 'BINYPreFilter' is whether the bumble bee was positive for the virus of interest, 'virusBINY' is whether the bumble bee was positive for the virus but takes into accont the limit of detection for each target, 'HB_Abun' is # of honey bees over total number bee observed- taken from bee abundance survey at each site. 'HBSiteBin' is for DWV data only. Honey Bee virus load results showed two distinct groups 'high' (VL) and 'low' (VL).
**Rows:** Bumble bee specimens
**Missing values:** NA
---
##Preliminaries:
```{r}
#Preliminaries:
# Clear memory of characters
ls()
rm(list=ls())
# Call blue color palette for graphics
library(RColorBrewer)
library(ggplot2)
library(dplyr)
library(plyr)
# Set Working Directory
setwd("~/AlgerProjects/2015_Bombus_Survey/CSV_Files")
# read in data
#BombSurv <- read.table("BombSurv.csv",header=TRUE,sep=",",stringsAsFactors=FALSE)
BombSurv <- read.table("BombSurvNHBS.csv",header=TRUE,sep=",",stringsAsFactors=FALSE)
# remove unneeded columns from the DF
#BombSurv <- select(BombSurv, -X, -Ct_mean, -Ct_sd, -quantity_mean, -quantity_sd, -run, -date_processed, -dil.factor, -genome_copbee, -Ct_mean_hb, -ID, -ACT_genome_copbee)
# remove unneeded columns from the DF
BombSurv <- dplyr::select(BombSurv, -City, -Name, -virusBINY_PreFilter)
# remove unwanted sites and bombus species
BombSurv<-BombSurv[!BombSurv$site==("PITH"),]
BombSurv<-BombSurv[!BombSurv$site==("STOW"),]
BombSurv<-BombSurv[!BombSurv$species==("Griseocollis"),]
BombSurv<-BombSurv[!BombSurv$species==("Sandersonii"),]
```
##Prevelence of viruses in bumble bees
```{r,  echo=FALSE}
# using ddply to get summary of virusBINY by species and target name:
VirusSum <- ddply(BombSurv, c("target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
#choosing color pallet
colors <- c("dodgerblue4", "dodgerblue4", "dodgerblue4")
#Create a bar graph for viruses by bombus species (aes= aesthetics):
plot1 <- ggplot(VirusSum, aes(x=target_name, y=mean, fill=target_name)) +
geom_bar(stat="identity",
position=position_dodge()) + labs(x="Virus", y = "% Prevalence")
plot1 + theme_minimal(base_size = 17) + theme(legend.position=c(3, 3)) + coord_cartesian(ylim = c(0, 1)) + scale_fill_manual(values=colors) + scale_y_continuous(labels = scales::percent)
```
##Prevalence by bumble bee species:
**FIGURES:**
```{r}
# using ddply to get summary of virusBINY by species and target name:
VirusSum <- ddply(BombSurv, c("species", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
#choosing color pallet
colors <- c("steelblue", "tan3")
#Create a bar graph for viruses by bombus species (aes= aesthetics):
plot1 <- ggplot(VirusSum, aes(x=target_name, y=mean, fill=species)) +
geom_bar(stat="identity",
position=position_dodge()) + labs(x="Virus", y = "% Prevalence")
plot1 + theme_minimal(base_size = 17) + scale_fill_manual(values=colors, name="Bombus Species:", labels=c("bimaculatus", "vagans")) + theme(legend.position=c(.8, .85)) + coord_cartesian(ylim = c(0, 1)) + scale_y_continuous(labels = scales::percent)
```
**Figure 1:** Percent prevalence (% of infected individuals) for two bumble bee species, *Bombus bimaculatus* and *Bombus vagans* for black queen cell virus (BQCV), deformed wing virus (DWV) and Israeli acute paralysis virus (IAPV). BQCV was significantly more prevalent among *B. bimaculatus* than *B. vagans* (p<0.00001). No significant differences in DWV prevalence between species (p = 0.9469). IAPV was detected only in low levels among a few individuals. This figure only includes bees with quantifiable viral infections above the threshold of detection.
**STATS:**
```{r}
#stats for % prevalence, species differences
statsplit <- split(BombSurv, BombSurv$target_name)
# chi.sq test for BQCV prev. vs species (p < 0.00001)
chisq.test(statsplit$BQCV$virusBINY, statsplit$BQCV$species)
fisher.test(statsplit$BQCV$virusBINY, statsplit$BQCV$species)
# chi.sq test for DWV prev. vs species (p = 0.9469)
chisq.test(statsplit$DWV$virusBINY, statsplit$DWV$species)
```
##Bumble bee virus prevalence as a function of Apiary present/absent
**FIGURES**
```{r}
# make apiary binary a character so we can use it as a factor in the model
BombSurv$apiary_near_far <- as.character(BombSurv$apiary_near_far)
# using ddply to get summary of virusBINY by species and target name:
VirusSum1 <- ddply(BombSurv, c("apiary_near_far", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
#choosing color pallet
colors <- c("slategray3", "dodgerblue4")
#Create a bar graph for viruses by bombus species (aes= aesthetics):
plot1 <- ggplot(VirusSum1, aes(x=target_name, y=mean, fill=apiary_near_far)) +
geom_bar(stat="identity",
position=position_dodge()) + labs(x="Virus", y = "% Prevalence")
plot1 + theme_minimal(base_size = 17) + scale_fill_manual(values=colors, name="Site Type:", labels=c("Apiary Absent", "Apiary Present")) + theme(legend.position=c(.8, .85)) + coord_cartesian(ylim = c(0, 1)) + scale_y_continuous(labels = scales::percent)
```
**Figure 2:** Percent prevalence of infected bumble bee individuals for black queen cell virus (BQCV), deformed wing virus (DWV) and Israeli acute paralysis virus (IAPV). Bumble bees were either caught in sites with honey bee apiaries present or no apiary nearby. BQCV (p<.0001) and DWV (p=.00225) were more prevalent in bumble bees caught in sites with a honey bee apiary present than in sites without an apiary nearby. IAPV was detected only in very low levels among a few individuals. This figure only includes bees with quantifiable viral infections above the threshold of detection for quantification.
**STATS**
```{r}
#stats for % prevalence, apiary_near_far differences
#remove NAs before doing test
PresAbst_stat <- BombSurv[which(BombSurv$apiary_near_far!="NA"),]
PresAbst_stat <- split(PresAbst_stat, PresAbst_stat$target_name)
# chi.sq test for BQCV prev. vs apiary_near_far (p < 0.00001)
chisq.test(PresAbst_stat$BQCV$virusBINY, PresAbst_stat$BQCV$apiary_near_far)
# chi.sq test for DWV prev. vs apiary_near_far (p =  0.001814)
chisq.test(PresAbst_stat$DWV$virusBINY, PresAbst_stat$DWV$apiary_near_far)
```
##Distribution of honey bee viral loads: "Clustered HoneyBees". Honey bee virus load data falls into a binomial distribution with samples eiher high or low.
**FIGURES**
```{r}
# summary of viral load for by target and site
CopDist <- ddply(BombSurv, c("target_name", "site"), summarise,
n = length(norm_genome_copbeeHB),
mean = mean(norm_genome_copbeeHB, na.rm=TRUE),
sd = sd(norm_genome_copbeeHB, na.rm=TRUE),
se = sd / sqrt(n))
CopDist<-CopDist[!CopDist$target_name==("BQCV"),]
CopDist<-CopDist[!CopDist$target_name==("IAPV"),]
# histogram of log mean viral for DWV  at each site showing bimodality for site:
hist(log(CopDist$mean),
breaks=20,
xlim = c(5,25),
col = "dodgerblue4",
xlab = "Honeybee DWV level log(viral load)",
main = "Distribution of DWV Viral Load in Honeybees",
cex.lab = 1.3,
font.lab = 2
)
```
##Creating a figure showing bumble bee viral prevalence as a function of honey bee viral load (bins) or honey bees absent.
**FIGURES**
```{r}
BombSurvSplit <- split(BombSurv, BombSurv$target_name)
BombSurvSplit$DWV$HBSiteBin[is.na(BombSurvSplit$DWV$HBSiteBin)] <- "No Apis Caught"
HBSiteSum <- ddply(BombSurvSplit$DWV, c("HBSiteBin", "target_name"), summarise,
n = length(virusBINY),
mean = mean(virusBINY, na.rm=TRUE),
sd = sd(virusBINY, na.rm=TRUE),
se = sd / sqrt(n))
colors <- c("slategray3", "dodgerblue4", "blue4")
plot1 <- ggplot(HBSiteSum, aes(x=HBSiteBin, y=mean, fill=colors)) +
geom_bar(stat="identity") + labs(x=NULL, y = "% Prevalence")
plot1 + theme_minimal(base_size = 17) + scale_fill_manual(values=colors) + coord_cartesian(ylim = c(0, 0.2)) + scale_y_continuous(labels = scales::percent) + theme(legend.position=c(3, 3))
```
**Figure 3:** Percent prevalance for Bumble bees infected with deformed wing virus at sites where honey bees had high and low viral loads, and sites where no honey bees were present and therefore could not be collected. DWV was more prevalent in bumble bees caught at sites with honey bees with high average viral loads, than sites with honey bees with low average viral loads (p = 0.046, X2 = 3.9767).
```{r}
# recode NAs for HBsiteBin as None to indicate no HB caught at site:
x <- BombSurvSplit$DWV[BombSurvSplit$DWV$HBSiteBin!="No Apis Caught",]
# loooking at diffence between high and low
chisq.test(x$HBSiteBin, x$virusBINY)
# chi.sq test for High and Low DWV load sites
chisq.test(BombSurvSplit$DWV$HBSiteBin, BombSurvSplit$DWV$virusBINY)
fisher.test(BombSurvSplit$DWV$HBSiteBin, BombSurvSplit$DWV$virusBINY)
```
##Difference in virus prevalence in bumble bees over the season:
**FIGURES**
```{r}
# Figure to see differences in virus prevalence over time
BombSurv$Date_collected <- as.Date(BombSurv$Date_collected, "%m/%d/%y")
tempsplit <- split(BombSurv, BombSurv$target_name)
BombSurv$Date_Pooled <- ifelse(BombSurv$Date_collected >= "2015-08-03", "August", ifelse(BombSurv$Date_collected >= "2015-07-28", "July", ifelse(BombSurv$Date_collected >= "2015-07-16", "July", "June")))
BombSurv$Date_Pooled <- factor(BombSurv$Date_Pooled, levels = c("June", "July", "August"))
library(dplyr)
sp <- split(BombSurv, BombSurv$species)
# create summary and sd and se using plyr
library(plyr)
VirusSum2 <- ddply(sp$Bimaculatus, c("target_name", "Date_Pooled"), summarise,
n = length(virusBINY),
mean = mean(virusBINY),
sd = sd(virusBINY),
se = sd / sqrt(n))
VirusSum2 <- VirusSum2[-(7:9),]
library(ggplot2)
#Create plot in ggplot
plot <- ggplot(data = VirusSum2,
aes(x = Date_Pooled,
y = mean,
group = target_name,
colour = target_name)
) + geom_line(size=1.5) + geom_point(size=4) + scale_colour_manual(values = c("dodgerblue4", "black")) + coord_cartesian(ylim = c(0, 1)) + labs(x = "Month", y = "% Prevalence", color="Virus:") + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.2)) + scale_y_continuous(labels = scales::percent)
# add a theme and add asterix for significance
plot + scale_fill_brewer(palette = "Paired") + theme_minimal(base_size = 17) + theme(legend.position=c(.85, .85)) + coord_cartesian(ylim = c(0, 1))
mod <- glm(tempsplit$BQCV$virusBINY~tempsplit$BQCV$Date_collected)
summary(mod)
```
Setting up data for regression between mean(bomble bee viral load) and HB viral load by site:
```{r}
# summary of bumbus viral load by site and target
VirusModel <- ddply(BombSurv, c("target_name", "site"), summarise,
n = length(norm_genome_copbee),
mean = mean(norm_genome_copbee),
sd = sd(norm_genome_copbee),
se = sd / sqrt(n))
BombSurv$norm_genome_copbee[BombSurv$norm_genome_copbee == 0] <- NA
VirusModelNA <- ddply(BombSurv, c("target_name", "site"), summarise,
n = length(norm_genome_copbee),
mean = mean(norm_genome_copbee, na.rm=TRUE),
sd = sd(norm_genome_copbee, na.rm=TRUE),
se = sd / sqrt(n))
# selcting the columns I want:
VirusModelNA <- dplyr::select(VirusModelNA, target_name, site, mean)
VirusModelNA <- rename(VirusModelNA, c("mean"="BombMeanNA"))
VirusModelNA$BombMeanNA[VirusModelNA$BombMeanNA == "NaN"] <- 0
# summary of HB viral load by site and target
VirusModelHB <- ddply(BombSurv, c("target_name", "site"), summarise,
n = length(norm_genome_copbeeHB),
mean = mean(norm_genome_copbeeHB),
sd = sd(norm_genome_copbeeHB),
se = sd / sqrt(n))
VirusBombPrev <- ddply(BombSurv, c("target_name", "site"), summarise,
n = length(virusBINY),
mean = mean(virusBINY),
sd = sd(virusBINY),
se = sd / sqrt(n))
# selcting the columns I want:
VirusBombPrev <- dplyr::select(VirusBombPrev, target_name, site, mean)
VirusBombPrev <- rename(VirusBombPrev, c("mean"="BombPrev"))
# get apiary near far data:
library(dplyr)
xx <- dplyr::select(BombSurv, site, apiary_near_far, target_name, ShannonDIV, Density, sumApiaries, sumColonies)
xx <- unique(xx)
# selcting the columns I want:
VirusModelHB <- dplyr::select(VirusModelHB, target_name, site, mean)
# merge HB and Bombus DFs and rename columns:
viralLoadDF <- merge(VirusModelHB, VirusModel, by=c("target_name","site"))
viralLoadDF <- rename(viralLoadDF, c("mean.x"="HBviralLoad", "mean.y"="BombusViralLoad"))
# merge in eco data
viralLoadDF <- merge(viralLoadDF, xx, by=c("target_name","site"))
# merge in prev for bombus
viralLoadDF <- merge(viralLoadDF, VirusBombPrev, by=c("target_name","site"))
# merge for bombus
viralLoadDF <- merge(viralLoadDF, VirusModelNA, by=c("target_name","site"))
# remove IAPV data (all 0 anyway)
viralLoadDF <- viralLoadDF[!viralLoadDF$target_name==("IAPV"),]
# recoding NA as 0 for sites where no HB were found (prev of Virus is 0 so Viral load is also 0 or NULL)
viralLoadDF$HBviralLoad[is.na(viralLoadDF$HBviralLoad)] <- 0
# split DF by target name:
x <- split(viralLoadDF, viralLoadDF$target_name)
# linear regression of HB load and Bombus load for DWV
plot(x=log10(x$DWV$HBviralLoad), y=log10(x$DWV$BombusViralLoad))
modDWV <- lm(log10(x$DWV$BombusViralLoad+1)~log10(x$DWV$HBviralLoad+1))
summary(modDWV)
# linear regression of HB load and Bombus load for BQCV
plot(x=log10(x$BQCV$HBviralLoad), y=log10(x$BQCV$BombusViralLoad))
modBQCV <- lm(log10(x$BQCV$BombusViralLoad+1)~log10(x$BQCV$HBviralLoad+1))
summary(modBQCV)
# looking at mean bombus viral load by site viral prev for DWV (p=0.02)
plot(x=x$DWV$BombPrev, y=log10(x$DWV$BombMeanNA))
modDWV1 <- lm(log10(x$DWV$BombMeanNA+1)~x$DWV$BombPrev)
summary(modDWV1)
# looking at sans sites and values for each of them
cbind(x$DWV$site, x$DWV$apiary_near_far, x$DWV$HBviralLoad, x$DWV$BombusViralLoad)
```
```{r}
Combining BombSurv with GIS data
print(viralLoadDF)
# make apiary near far a factor variable:
viralLoadDF$apiary_near_far <- as.factor(viralLoadDF$apiary_near_far)
library(lme4)
library(MASS)
# mixed model for DWV load and apiary status (significant)
mod <- glmmPQL(data=x$DWV, fixed = BombMeanNA~apiary_near_far+sumApiary, random = ~ 1 | site, family = gaussian)
summary(mod)
