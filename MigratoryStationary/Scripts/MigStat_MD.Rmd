---
title: "Migratory Stationary Technical Report"
author: "P. Alexander Burnham & Samantha A. Alger"
date: "October 24, 2017"
output:
  pdf_document: default
  html_document: default
---

```{r, echo=FALSE, warning=FALSE, message=FALSE}

# Preliminaries:
# Clear memory of characters:
rm(list=ls())

# Set Working Directory: 
setwd("~/AlgerProjects/MigratoryStationary/")

# Read in Nosema/Varroa/Eco Data:
MigStat <- read.table("Data/MigStatClean.csv", 
                      header=TRUE, 
                      sep = ",", 
                      stringsAsFactors = FALSE) 

#MigStat$NosemaLoadRecount <- log(MigStat$NosemaLoadRecount+1)
MigStat$Varroa <- 1/(MigStat$Varroa+1)
MigStat$NosemaLoadRecount <- 1/(MigStat$NosemaLoadRecount+1)

# required packages:
library(plyr)
library(ggplot2)
library(dplyr)
library(lme4)
library(car)
library(MASS)
library(vegan)
library(factoextra)

```

# EXPERIMENT I  -  (MIGRATORY vs STATIONARY)

```{r, echo=FALSE}
# Setting up dataframe without Exposed for Experiment 1 data (Mig vs Stationary)
MigStatExp_1<-MigStat[!(MigStat$Treatment=="Exposed"),]

# create data frame for running preliminary T1 tests
MigStatExp_1_T1<-MigStatExp_1[(MigStatExp_1$SamplingEvent=="1"),]


```

## Deformed Wing Virus Prevalence:



```{r, echo=FALSE, warning=FALSE}
# Summary of DWV prev. for experiment 1
VirusSum <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(DWVbinary),
                   mean = mean(DWVbinary, na.rm=TRUE),
                   sd = sd(DWVbinary, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting DWV prev. for experiment 1
DWVprev1 <- ggplot(data = VirusSum, 
               aes(x = SamplingEvent, 
                   y = mean, 
                   group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "Prevalance of DWV") + coord_cartesian(ylim = c(0, 1), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
DWVprev1 
VirusSum
```


####Initial Time Step One Analaysis (Chi Square)


```{r, echo=FALSE}
# Initial T1 test:
x <- table(MigStatExp_1_T1$Treatment, MigStatExp_1_T1$DWVbinary)
chisq.test(x)
```


#### Full repeated measures Analaysis (GLM)

```{r, echo=FALSE}
# DWV prevalence using glmer
Fullmod <- glmer(data=MigStatExp_1, formula = DWVbinary~Treatment * SamplingEvent + (1|ID), family = binomial(link = "logit"))
Anova(Fullmod)
```



## Deformed Wing Virus Load:



```{r, echo=FALSE, warning=FALSE}
# Summary of DWV prev. for experiment 1
VirusSum2 <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(logDWV),
                   mean = mean(logDWV, na.rm=TRUE),
                   sd = sd(logDWV, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting DWV prev. for experiment 1
DWVload1 <- ggplot(data = VirusSum2, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "DWV log(genome copies/bee)") + coord_cartesian(ylim = c(0, 15), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
DWVload1

VirusSum2
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_1_T1$logDWV~MigStatExp_1_T1$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for DWV
#aov.DWV <- aov(logDWV~Treatment * SamplingEvent + Error(ID), data=MigStatExp_1)
#summary(aov.DWV)



nbDWV <- lmer(data=MigStatExp_1, formula = logDWV~Treatment * SamplingEvent + (1|ID))
Anova(nbDWV)


```
























## Black Queen Cell Virus Prevalence:



```{r, echo=FALSE, warning=FALSE}

# Summary of BQCV prev. for experiment 1
VirusSum3 <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                  n = length(BQCVbinary),
                  mean = mean(BQCVbinary, na.rm=TRUE),
                  sd = sd(BQCVbinary, na.rm = TRUE),
                  se = sd / sqrt(n))

# plotting BQCV prev. for experiment 1
BQCVprev1 <- ggplot(data = VirusSum3, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "Prevalance of BQCV") + coord_cartesian(ylim = c(0, 1), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.2, .2),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
BQCVprev1

VirusSum3

```


####Initial Time Step One Analaysis (Chi Square)


```{r, echo=FALSE}
# Initial T1 test:
x <- table(MigStatExp_1_T1$Treatment, MigStatExp_1_T1$BQCVbinary)
chisq.test(x)
```


#### Full repeated measures Analaysis (GLM)

```{r}
#BQCV prevalence using glmer
#Fullmod2 <- glmer(data=MigStatExp_1, formula = BQCVbinary~Treatment * SamplingEvent + (1|ID), family = binomial(link = "logit"))
#Anova(Fullmod2)
```



## Black Queen Cell Virus Load:



```{r, echo=FALSE, warning=FALSE}

# Summary of BQCV prev. for experiment 1
VirusSum1 <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                  n = length(logBQCV),
                  mean = mean(logBQCV, na.rm=TRUE),
                  sd = sd(logBQCV, na.rm = TRUE),
                  se = sd / sqrt(n))

# plotting BQCV prev. for experiment 1
BQCVload1 <- ggplot(data = VirusSum1, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "BQCV log(genome copies/bee)") + coord_cartesian(ylim = c(10, 25), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
BQCVload1

VirusSum1

```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_1_T1$logBQCV~MigStatExp_1_T1$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for BQCV
#aov.BQCV <- aov(logBQCV~Treatment * SamplingEvent + Error(ID), data=MigStatExp_1)
#summary(aov.BQCV)


nbBQCV <- lmer(data=MigStatExp_1, formula = logBQCV~Treatment * SamplingEvent + (1|ID))
Anova(nbBQCV)

```



















## Varroa Mite Prevalence:



```{r, echo=FALSE, warning=FALSE}

# Summary of Varroa prev. for experiment 1
VarroaBin <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(VarroaBinary),
                   mean = mean(VarroaBinary, na.rm=TRUE),
                   sd = sd(VarroaBinary, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting Varroa prev. for experiment 1
VARprev1 <- ggplot(data = VarroaBin, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "Prevalance of Varroa") + coord_cartesian(ylim = c(0, 1), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.8, .2),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
VARprev1

VarroaBin
```


####Initial Time Step One Analaysis (Chi Square)


```{r, echo=FALSE}
# Initial T1 test:
x <- table(MigStatExp_1_T1$Treatment, MigStatExp_1_T1$VarroaBinary)
chisq.test(x)
```


#### Full repeated measures Analaysis (GLM)

```{r, echo=FALSE}

#Varroa prevalence using glmer
Fullmod2 <- glmer(data=MigStatExp_1, formula = VarroaBinary~Treatment * SamplingEvent + (1|ID), family = binomial(link = "logit"))
Anova(Fullmod2)
```



## Varroa Mite Load:



```{r, echo=FALSE, warning=FALSE}

# Summary of Varroa prev. for experiment 1
VarSum <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(Varroa),
                   mean = mean(Varroa, na.rm=TRUE),
                   sd = sd(Varroa, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting Varroa prev. for experiment 1
VARload1 <- ggplot(data = VarSum, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "Varroa (mites/100 bees))") + coord_cartesian(ylim = c(0, 3), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
VARload1

VarSum
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_1_T1$Varroa~MigStatExp_1_T1$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for Varroa
#aov.Var <- aov(Varroa~Treatment * SamplingEvent + Error(ID), data=MigStatExp_1)
#summary(aov.Var)


nbVAR <- lmer(data=MigStatExp_1, formula = Varroa~Treatment * SamplingEvent + (1|ID))
Anova(nbVAR)
```














## Nosema Prevalence:



```{r, echo=FALSE, warning=FALSE}

# Summary of Varroa prev. for experiment 1
NosemaBin <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(NosemaBinary),
                   mean = mean(NosemaBinary, na.rm=TRUE),
                   sd = sd(NosemaBinary, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting Varroa prev. for experiment 1
NOSprev1 <- ggplot(data = NosemaBin, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "Prevalance of Nosema") + coord_cartesian(ylim = c(0, 1), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.8, .2),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
NOSprev1

NosemaBin
```


####Initial Time Step One Analaysis (Chi Square)


```{r, echo=FALSE, warning=FALSE}
# Initial T1 test:
x <- table(MigStatExp_1_T1$Treatment, MigStatExp_1_T1$NosemaBinary)
chisq.test(x)
```


#### Full repeated measures Analaysis (GLM)

```{r, echo=FALSE}

#Varroa prevalence using glmer
Fullmod2 <- glmer(data=MigStatExp_1, formula = NosemaBinary~Treatment * SamplingEvent + (1|ID), family = binomial(link = "logit"))
Anova(Fullmod2)
```



## Nosema Load:



```{r, echo=FALSE, warning=FALSE}

# Summary of Nosema prev. for experiment 1
NosSum <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(NosemaLoadRecount),
                   mean = mean(NosemaLoadRecount, na.rm=TRUE),
                   sd = sd(NosemaLoadRecount, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting Nosema prev. for experiment 1
NOSload1 <- ggplot(data = NosSum, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "Nosema Load") + coord_cartesian(ylim = c(0, 20), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.7, .85),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
NOSload1

NosSum
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_1_T1$NosemaLoadRecount~MigStatExp_1_T1$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for Varroa
#aov.Var <- aov(NosemaLoadRecount~Treatment * SamplingEvent + Error(ID), data=MigStatExp_1)
#summary(aov.Var)



nbNos <- lmer(data=MigStatExp_1, formula = NosemaLoadRecount~Treatment * SamplingEvent + (1|ID))
Anova(nbNos)
```




















## Frames of Bees:



```{r, echo=FALSE, warning=FALSE}

# Summary of FOB for experiment 1
FOB <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
                n = length(FOB),
                mean = mean(FOB, na.rm=TRUE),
                sd = sd(FOB, na.rm = TRUE),
                se = sd / sqrt(n))

# plotting FOB for experiment 1
FOB1 <- ggplot(data = FOB, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "Frames of Bees") + coord_cartesian(ylim = c(5, 25), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
FOB1

FOB
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_1_T1$FOB~MigStatExp_1_T1$Treatment)
summary(x)

x <- table(MigStatExp_1_T1$FOB, MigStatExp_1_T1$Treatment)
chisq.test(x)


```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for FOB
#aov.FOB <- aov(FOB~Treatment * SamplingEvent + Error(ID), data=MigStatExp_1)
#summary(aov.FOB)


nbFOB <- lmer(data=MigStatExp_1, formula = FOB~Treatment * SamplingEvent + (1|ID))
Anova(nbFOB)

```















## Brood Pattern:



```{r, echo=FALSE, warning=FALSE}


# Summary of Brood pat for experiment 1
BroodPat <- ddply(MigStatExp_1, c("Treatment", "SamplingEvent"), summarise, 
             n = length(BroodPattern),
             mean = mean(BroodPattern, na.rm=TRUE),
             sd = sd(BroodPattern, na.rm = TRUE),
             se = sd / sqrt(n))

# plotting brood pat for experiment 1
BP1 <- ggplot(data = BroodPat, 
       aes(x = SamplingEvent, 
           y = mean, 
           group = Treatment)
) + geom_point(size=4) + labs(x = "Sampling Event", y = "Brood Pattern") + coord_cartesian(ylim = c(2, 8), xlim = c(1,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05)) + geom_line(aes(linetype=Treatment), size=1.5) + scale_fill_brewer(palette = "Paired") + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85),legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + labs(linetype="Operation Type:") + scale_x_continuous(breaks=c(1,2,3))
BP1

BroodPat
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_1_T1$BroodPattern~MigStatExp_1_T1$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for Brood Pattern
#aov.BroodPat <- aov(BroodPattern~Treatment * SamplingEvent + Error(ID), data=MigStatExp_1)
#summary(aov.BroodPat)


nbBP <- lmer(data=MigStatExp_1, formula = BroodPattern~Treatment * SamplingEvent + (1|ID))
Anova(nbBP)
```




















# EXPERIMENT II  -  (EXPOSED vs STATIONARY)

```{r, echo=FALSE}
# Setting up dataframe without time point 1 for Experiment 2 data (Stationary vs Exposed)
MigStatExp_2_plot<-MigStat[!(MigStat$SamplingEvent=='1'),]

# same data frame but without migratory for analysis purposes 
MigStatExp_2_analysis<-MigStatExp_2_plot[!(MigStatExp_2_plot$Treatment=="Migratory"),]

# same data frame but only T2 to check initial levels
MigStatExp_2_analysis_T2<-MigStatExp_2_analysis[(MigStatExp_2_analysis$SamplingEvent=='2'),]
```












## Deformed Wing Virus Prevalence:



```{r, echo=FALSE, warning=FALSE}

# Summary of DWV prev. for experiment 2
VirusSum5 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                  n = length(DWVbinary),
                  mean = mean(DWVbinary, na.rm=TRUE),
                  sd = sd(DWVbinary, na.rm = TRUE),
                  se = sd / sqrt(n))

# plotting DWV prev. for experiment 2
DWVprev2 <- ggplot(data = VirusSum5, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "Prevalance of DWV") + coord_cartesian(ylim = c(0, 1), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
DWVprev2

VirusSum5

```


####Initial Time Step One Analaysis (Chi Square)


```{r, echo=FALSE}
# Initial T1 test:
x <- table(MigStatExp_2_analysis_T2$Treatment, MigStatExp_2_analysis_T2$DWVbinary)
chisq.test(x)
```


#### Full repeated measures Analaysis (GLM)

```{r, echo=FALSE}
#DWV prevalence using glmer
Fullmod3 <- glmer(data=MigStatExp_2_analysis, formula = DWVbinary~Treatment * SamplingEvent + (1|ID), family = binomial(link = "logit"))
Anova(Fullmod3)
```



## Deformed Wing Virus Load:



```{r, echo=FALSE, warning=FALSE}
# Summary of DWV VL for experiment 2
VirusSum6 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(logDWV),
                   mean = mean(logDWV, na.rm=TRUE),
                   sd = sd(logDWV, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting DWV VL for experiment 2
DWVload2 <- ggplot(data = VirusSum6, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "DWV log(genome copies/bee)") + coord_cartesian(ylim = c(0, 17), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
DWVload2

VirusSum6
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_2_analysis_T2$logDWV~MigStatExp_2_analysis_T2$Treatment)
summary(x)



```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for DWV
aov.DWV2 <- aov(logDWV~Treatment * SamplingEvent + Error(ID), data=MigStatExp_2_analysis)
summary(aov.DWV2)

Fullmod4 <- lmer(data=MigStatExp_2_analysis, formula = logDWV~Treatment * SamplingEvent + (1|ID))
Anova(Fullmod4)
```





















## Black Queen Cell Virus Prevalence:



```{r, echo=FALSE, warning=FALSE}

# Summary of BQCV prev. for experiment 2
VirusSum7 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(BQCVbinary),
                   mean = mean(BQCVbinary, na.rm=TRUE),
                   sd = sd(BQCVbinary, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting BQCV prev. for experiment 2
BQCVprev2 <- ggplot(data = VirusSum7, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "Prevalance of BQCV") + coord_cartesian(ylim = c(0, 1), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.2, .2), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
BQCVprev2

VirusSum7
```


####Initial Time Step One Analaysis (Chi Square)


```{r, echo=FALSE}
# Initial T1 test:
x <- table(MigStatExp_2_analysis_T2$Treatment, MigStatExp_2_analysis_T2$BQCVbinary)
chisq.test(x)
```


#### Full repeated measures Analaysis (GLM)

```{r, echo=FALSE}
#BQCV prevalence using glmer
#Fullmod4 <- glmer(data=MigStatExp_2_analysis, formula = BQCVbinary~Treatment * SamplingEvent + (1|ID), family = binomial(link = "logit"))
#Anova(Fullmod4)
```



## Black Queen Cell Virus Load:



```{r, echo=FALSE, warning=FALSE}

# Summary of BQCV VL for experiment 2
VirusSum8 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(logBQCV),
                   mean = mean(logBQCV, na.rm=TRUE),
                   sd = sd(logBQCV, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting BQCV VL for experiment 2
BQCVload2 <- ggplot(data = VirusSum8, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "BQCV log(genome copies/bee)") + coord_cartesian(ylim = c(10, 25), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
BQCVload2

VirusSum8
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_2_analysis_T2$logBQCV~MigStatExp_2_analysis_T2$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for BQCV
#aov.BQCV2 <- aov(logBQCV~Treatment * SamplingEvent + Error(ID), data=MigStatExp_2_analysis)
#summary(aov.BQCV2)



Fullmod5 <- lmer(data=MigStatExp_2_analysis, formula = logBQCV~Treatment * SamplingEvent + (1|ID))
Anova(Fullmod5)
```




























## Varroa Mite Prevalence:



```{r, echo=FALSE, warning=FALSE}



# Summary of Varroa prev. for experiment 2
VirusSum5 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(VarroaBinary),
                   mean = mean(VarroaBinary, na.rm=TRUE),
                   sd = sd(VarroaBinary, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting Varroa prev. for experiment 2
VARprev2 <- ggplot(data = VirusSum5, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "Prevalance of Varroa") + coord_cartesian(ylim = c(0, 1), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.8, .2), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
VARprev2

VirusSum5
```


####Initial Time Step One Analaysis (Chi Square)


```{r, echo=FALSE}
# Initial T1 test:
x <- table(MigStatExp_2_analysis_T2$Treatment, MigStatExp_2_analysis_T2$VarroaBinary)
chisq.test(x)
```


#### Full repeated measures Analaysis (GLM)

```{r, echo=FALSE}
#Varroa prevalence using glmer

Fullmod10 <- glmer(data=MigStatExp_2_analysis, formula = VarroaBinary~Treatment * SamplingEvent + (1|ID), family = binomial(link = "logit"), nAGQ = 0)
Anova(Fullmod10)
```



## Varroa Mite Load:



```{r, echo=FALSE, warning=FALSE}


# Summary of varroa load for experiment 2
VarSum2 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(Varroa),
                   mean = mean(Varroa, na.rm=TRUE),
                   sd = sd(Varroa, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting varroa load for experiment 2
VARload2 <- ggplot(data = VarSum2, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "Varroa (mites/100 bees)") + coord_cartesian(ylim = c(0, 5), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
VARload2

VarSum2
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_2_analysis_T2$Varroa~MigStatExp_2_analysis_T2$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for Varroa

#aov.Var2 <- aov(Varroa~Treatment * SamplingEvent + Error(ID), data=MigStatExp_2_analysis)
#summary(aov.Var2)


Fullmod15 <- lmer(data=MigStatExp_2_analysis, formula = Varroa~Treatment * SamplingEvent + (1|ID))
Anova(Fullmod15)

```

























## Nosema Prevalence:



```{r, echo=FALSE, warning=FALSE}



# Summary of Varroa prev. for experiment 2
VirusSum11 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(NosemaBinary),
                   mean = mean(NosemaBinary, na.rm=TRUE),
                   sd = sd(NosemaBinary, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting Varroa prev. for experiment 2
NOSprev2 <- ggplot(data = VirusSum11, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "Prevalance of Nosema") + coord_cartesian(ylim = c(0, 1), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.8, .2), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
NOSprev2

VirusSum11
```


####Initial Time Step One Analaysis (Chi Square)


```{r, echo=FALSE}
# Initial T1 test:
x <- table(MigStatExp_2_analysis_T2$Treatment, MigStatExp_2_analysis_T2$NosemaBinary)
chisq.test(x)
```


#### Full repeated measures Analaysis (GLM)

```{r, echo=FALSE}
#Varroa prevalence using glmer

Fullmod11 <- glmer(data=MigStatExp_2_analysis, formula = NosemaBinary~Treatment * SamplingEvent + (1|ID), family = binomial(link = "logit"))
Anova(Fullmod11)
```



## Nosema Load:



```{r, echo=FALSE, warning=FALSE}


# Summary of nosema load for experiment 2
NosSum2 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                   n = length(NosemaLoadRecount),
                   mean = mean(NosemaLoadRecount, na.rm=TRUE),
                   sd = sd(NosemaLoadRecount, na.rm = TRUE),
                   se = sd / sqrt(n))

# plotting nosema load for experiment 2
NOSload2 <- ggplot(data = NosSum2, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "Nosema Load") + coord_cartesian(ylim = c(0, 7), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
NOSload2

NosSum2
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_2_analysis_T2$NosemaLoadRecount~MigStatExp_2_analysis_T2$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for Varroa
#aov.Var2 <- aov(NosemaLoadRecount~Treatment * SamplingEvent + Error(ID), data=MigStatExp_2_analysis)
#summary(aov.Var2)


Fullmod6 <- lmer(data=MigStatExp_2_analysis, formula = NosemaLoadRecount~Treatment * SamplingEvent + (1|ID))
Anova(Fullmod6)
```






















## Frames of Bees:



```{r, echo=FALSE, warning=FALSE}

# Summary of FOB for experiment 2
FOB2 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
              n = length(FOB),
              mean = mean(FOB, na.rm=TRUE),
              sd = sd(FOB, na.rm = TRUE),
              se = sd / sqrt(n))

# plotting FOB for experiment 2
FOB3 <- ggplot(data = FOB2, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "Frames of Bees") + coord_cartesian(ylim = c(10, 30), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
FOB3

FOB2
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_2_analysis_T2$FOB~MigStatExp_2_analysis_T2$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for FOB
#aov.FOB2 <- aov(FOB~Treatment * SamplingEvent + Error(ID), data=MigStatExp_2_analysis)
#summary(aov.FOB2)


Fullmod7 <- lmer(data=MigStatExp_2_analysis, formula = FOB~Treatment * SamplingEvent + (1|ID))
Anova(Fullmod7)
```
















## Brood Pattern:



```{r, echo=FALSE, warning=FALSE}


# Summary of BroodPat for experiment 2
BroodPat2 <- ddply(MigStatExp_2_plot, c("Treatment", "SamplingEvent"), summarise, 
                 n = length(BroodPattern),
                 mean = mean(BroodPattern, na.rm=TRUE),
                 sd = sd(BroodPattern, na.rm = TRUE),
                 se = sd / sqrt(n))

# plotting BroodPat for experiment 2
BP2 <- ggplot(data = BroodPat2, 
       aes(x = SamplingEvent, 
           y = mean, 
           col = Treatment,
           linetype= Treatment)
) + geom_point(size=4) + scale_colour_manual(values = c("black", "darkgrey", "black")) + scale_linetype_manual(values = c(1, 1, 2)) + labs(x = "Sampling Event", y = "Brood Pattern") + coord_cartesian(ylim = c(3, 5), xlim = c(2,3)) + geom_errorbar(aes(ymin = mean - se, ymax = mean + se, width = 0.05), linetype=1, show.legend=FALSE) + geom_line(size=1.5) + theme_classic(base_size = 17) + theme(legend.position=c(.2, .85), legend.key.width=unit(5,"line"), panel.border = element_blank(), axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid'), panel.grid.major = element_blank(), panel.grid.minor = element_blank()) + scale_x_continuous(breaks=c(2,3)) 
BP2

BroodPat2 
```


####Initial Time Step One Analaysis (ANOVA)


```{r, echo=FALSE}
# Initial T1 test:
x <- aov(MigStatExp_2_analysis_T2$BroodPattern~MigStatExp_2_analysis_T2$Treatment)
summary(x)
```


#### Full repeated measures Analaysis (Rep ANOVA)

```{r, echo=FALSE}
# repeated measures anova for BroodPat
#aov.BroodPat2 <- aov(BroodPattern~Treatment * SamplingEvent + Error(ID), data=MigStatExp_2_analysis)
#summary(aov.BroodPat2)

Fullmod7 <- lmer(data=MigStatExp_2_analysis, formula = BroodPattern~Treatment * SamplingEvent + (1|ID))
Anova(Fullmod7)
```





















# OVER-ARCHING STUDY-WIDE ANALYSES

## Tempurature and Rainfall Date between CA and NC

```{r, echo=FALSE}

# Set Working Directory: 
setwd("~/AlgerProjects/MigratoryStationary/")

# Read in Temp. Data:
TempDat <- read.table("Data/TempData.csv", header=TRUE, sep = ",", stringsAsFactors = FALSE) 


# remove first and last four days for each state:
TempDat <- TempDat[-c(1,2,3,4,32,33,34,35,36,37,38,39,67,68,69,70),]

```



####Avg Temp. between NC and CA

```{r, echo=FALSE}
temp <- aov(AVG~State,data=TempDat)
summary(temp)
```



####Avg Windspeed between NC and CA

```{r, echo=FALSE}
wind <- aov(SPD~State,data=TempDat)
summary(wind)
```


####Rainfall between NC and CA

```{r, echo=FALSE}
tempRain <- aov(WTR~State,data=TempDat)
summary(tempRain)
```


## Linear regression between DWV load and Frames of bees

```{r, echo=FALSE}

# Setting up dataframe with T3 for regression
MigStat_3<-MigStat[(MigStat$SamplingEvent=='3'),]

MigStat_3_Exp <- MigStat_3[(MigStat_3$Treatment=='Exposed'),]


MigStat_1<-MigStat[(MigStat$SamplingEvent=='2'),]

MigStat_1_Mig <- MigStat_1[(MigStat_1$Treatment=='Migratory'),]
```


#### Regression between DWV and FOB
```{r, echo=FALSE}

x <- lm(MigStat_3_Exp$logDWV~MigStat_3_Exp$FOB)

plot(MigStat_3_Exp$FOB, MigStat_3_Exp$logDWV,
     ylab="log(DWV Load)",
     xlab = "Frames of Brood",
     main = "T3 Exposed"
     )
abline(x, col="blue")

# Setting up regression
summary(x)





###################################
#T1 Mig reg between FOB and BQCV load

x1 <- lm(MigStat_1_Mig$logBQCV~MigStat_1_Mig$FOB)

plot(MigStat_1_Mig$FOB, MigStat_1_Mig$logBQCV,
     ylab="log(BQCV Load)",
     xlab = "Frames of Brood",
     main ="T2 Migratory"
     )
abline(x1, col="red")

# Setting up regression
summary(x1)


```





## Linear Classification Anlaysis for all Vars on Grouping into Treatments (3 time points):
```{r, echo=FALSE}

# create seperate data frames for each time point:
MigStatSplit <- split(MigStat, MigStat$SamplingEvent)
Mig1 <- MigStatSplit$`1`
Mig2 <- MigStatSplit$`2`
Mig3 <- MigStatSplit$`3`

```




#### LDA for Time Point 2:
```{r, echo=FALSE}

# run LDA
time2 <- lda(Treatment~Varroa + NosemaLoadRecount + logBQCV + logDWV + DWVbinary + FOB + BroodPattern + NosemaBinary + VarroaBinary, data=Mig2, na.action="na.omit")

# LDA prep function 
ggplotLDAPrep <- function(x){
  if (!is.null(Terms <- x$terms)) {
    data <- model.frame(x)
    X <- model.matrix(delete.response(Terms), data)
    g <- model.response(data)
    xint <- match("(Intercept)", colnames(X), nomatch = 0L)
    if (xint > 0L) 
      X <- X[, -xint, drop = FALSE]
  }
  means <- colMeans(x$means)
  X <- scale(X, center = means, scale = FALSE) %*% x$scaling
  rtrn <- as.data.frame(cbind(X,labels=as.character(g)))
  rtrn <- data.frame(X,labels=as.character(g))
  return(rtrn)
}

# fit graph for LDA
fitGraph <- ggplotLDAPrep(time2)

LDAone <- ggplot(fitGraph, aes(LD1,LD2, color=labels))+geom_point() + theme_minimal(base_size = 17) + scale_colour_manual(values = c("slategrey", "red", "blue")) + theme(axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid')) + stat_ellipse(show.legend = FALSE, level=.7)
LDAone

time2
##################################
# classification analysis:
CA1 <- lda(Treatment~Varroa + NosemaLoadRecount + logBQCV + logDWV + DWVbinary + FOB + BroodPattern + NosemaBinary + VarroaBinary, data=Mig2, na.action="na.omit",prior=c(1,1,1)/3, CV=TRUE)

# create confusion matrix
cm1 <- data.frame(cbind(Mig2$Treatment, CA1$class))
names(cm1) <- c("actual", "predicted")
cm <- table(cm1)
colnames(cm) = c('Exposed', 'Migratory', 'Stationary')
rownames(cm) = c('Exposed', 'Migratory', 'Stationary')
cm

prop.table(cm,1)


# USEING CANDISc
#library(candisc)

#lm.mod <- lm(cbind(Varroa, NosemaLoadRecount, logBQCV, logDWV, DWVbinary, FOB, BroodPattern, NosemaBinary, VarroaBinary)~Treatment, data=Mig2)
#anova(lm.mod, test="Wilks")

#can.mod <- candisc(lm.mod, term="Treatment")
#can.mod
#summary(can.mod)




# create matrix for PERM
Mig2x <- na.omit(Mig2)
x <- dplyr::select(Mig2x, Varroa, NosemaLoadRecount, logBQCV, logDWV, DWVbinary, BSB, FOB, BroodPattern, NosemaBinary, VarroaBinary)

# run PERMANOVA
envdist1 <- vegdist(x, method= "jaccard")
AD1 <- adonis(envdist1~Treatment, data=Mig2x)
AD1


```



#### LDA for Time Point 3:
```{r, echo=FALSE}

# run LDA
time3 <- lda(Treatment~Varroa + NosemaLoadRecount + logBQCV + logDWV + DWVbinary + FOB + BroodPattern + NosemaBinary + VarroaBinary, data=Mig3, na.action="na.omit")

# graph for LDA
fitGraph1 <- ggplotLDAPrep(time3)

# graph for LDA
LDAtwo <- ggplot(fitGraph1, aes(LD1,LD2, color=labels))+geom_point() + theme_minimal(base_size = 17) + scale_colour_manual(values = c("blue", "slategrey", "red")) + theme(axis.line.x = element_line(colour = 'black', size=0.5, linetype='solid'), axis.line.y = element_line(colour = 'black', size=0.5, linetype='solid')) + stat_ellipse(show.legend = FALSE, level=.7)
LDAtwo
time3


# Classification Anlaysis 
CA2 <- lda(Treatment~Varroa + NosemaLoadRecount + logBQCV + logDWV + DWVbinary + FOB + BroodPattern + NosemaBinary + VarroaBinary, data=Mig3, na.action="na.omit",prior=c(1,1,1)/3, CV=TRUE)


# Confusion Matrix
cm1 <- data.frame(cbind(Mig3$Treatment, CA2$class))
names(cm1) <- c("actual", "predicted")
cm <- table(cm1)
colnames(cm) = c('Exposed', 'Migratory', 'Stationary')
rownames(cm) = c('Exposed', 'Migratory', 'Stationary')
cm
prop.table(cm,1)





# create data matrix for PCA and nMDS
Mig3x <- na.omit(Mig3)
x1 <- dplyr::select(Mig3x,Varroa, NosemaLoadRecount, logBQCV, logDWV, DWVbinary, FOB, BroodPattern, NosemaBinary, VarroaBinary)

# run PERMNAOVA
envdist <- vegdist(x1, method= "jaccard")
AD2 <- adonis(envdist~Treatment, data=Mig3x)
AD2
```












